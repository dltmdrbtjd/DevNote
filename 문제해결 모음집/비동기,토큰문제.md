## 오늘 내가 겪었던 문제 2가지
- 비동기 통신으로 인한 함수호출이 꼬인 문제 ( 원하는 데이터를 가져오는 시점이 잘못되었음 )
- 토큰을 받은 그대로 보내는 과정에서 값만 추출하여 보내지 않았던 문제

## 목록
### 1.이미지 업로드를 두번에 걸쳐서 업로드해야지 데이터에 url이 제대로 들어가는 문제 발생
- 비동기 통신에 관한 문제로 판단되어서 우선 업로드를 시작하는 지점부터 코드를 차례대로 따라가보면서 어떤 부분에서 문제가 발생하고있는지를 찾아보도록했다. 그리고 발견한 부분은 이미지를 업로드하는 함수와 데이터에 담는 함수를 따로따로 분리해서 만들었는데 이미지를 업로드하는 부분이 비동기통신으로 처리가 되어 있어서 작성완료 버튼클릭후에 업로드가 되고 이미지가 들어가서 작성완료가 클릭되는 시점에는 데이터에 이미지url이 담겨있지 않았던것이였다. 그래서 이 코드부분을 이미지를 업로드하는 부분의 함수에서 이미지를 선택하고 그 url을 데이터에 넣고 dispatch시킨 다음에 작성이 완료되면서 업로드가 되게끔하도록 로직을 변경하였다. 즉 해당유저가 이미지를 선택하고 작성완료 버튼을 클릭하면 그 함수안에서 이미지를 AWS S3서버에 넣고 그 url을 다시 불러와서 데이터에 url을 담고 작성완료 버튼이 실행이되는 로직이다. 이 부분을 따로따로 만들어서 실행시키고 있어서 처음에 이미지url이 제대로 들어오지 않았던 것이였다. 오늘 이 문제를 해결하면서 비동기통신에 대한 이해가 좀 더 생겼고 함수의 호출에 대한 순서에 대해서 다시 정리가되는 시간이여서 매우 좋은경험이였다고 생각한다.
```javascript
// 원하는 데이터를 리덕스 상태에 담고 그 다음 data로 넘겨줄 객체에 그 imageUrl을 넣어주고나서 그 데이터를 작성완료dispatch에 넣어주고 실행시키게끔 수정했다.
const promise = upload.promise();

promise.then((data)=>{
 dispatch(imageCreators.imageUpload(data.Location));
 const content = { ...contents, imageUrl: data.Location }
 dispatch(articleActions.addArticleDB(content));
}).catch((err)=>{window.alert("이미지 업로드에 문제가 있어요!")});
// 

```

### 2. 토큰값을 이상하게 보내고있던 문제
- 서버에서 준 토큰을 받아와서 쿠키에 저장하고 사용하고 또 다시 서버에 요청을 보낼때마다 쿠키값을 보내줘서 현재 쿠키가 유효한지에 대한 검사를 서버에서 해줘야하는데 이 부분에서 토큰값이 제대로 들어가지 않는 오류가 발생했는데 이 토큰이 document.cookie('키')로 뽑는게 불가능한걸 모르고있었다.. 그래서 split으로 '=' 이 부분을 기준으로 배열로 잘라낸다음 키값만 있는 부분으로 받아와서 그걸 다시 response headers에 담아서 보내는 방식으로 진행했을때는 쿠키를 클라이언트에서 서버로 보내는 문제를 해결했다.
 ```javascript
 // split으로 값만 빼서 서버로 전달
 const accessToken = document.cookie.split('=')[1]
 api.defaults.headers.common['Authorization'] = `${accessToken}`;
 ```

## ++ 추후에 추가 작업하며 2번 문제를 다시 해결했다.
- 우선 토큰을 주고있는 네임이 서버랑 우리가 일치하지 않아서 계속 오류가 또 발생했었다. 그래서 서버에서 지정한 'X-AUTH-TOKEN'이라는 값으로 우리도 헤더에 저 이름을 사용해서 토큰을 보내주게끔 처리하니까 드디어 완벽하게 서로 왔다갔다하는 작업이 끝났다... 진짜 애먹었다.
```javascript
headers: {
		'content-type': 'application/json;charset=UTF-8',
		accept: 'application/json,',
		'X-AUTH-TOKEN': `${accessToken}`,
	},
```
위와 같은 형태로 2번 코드를 바꿔서 다시 보내고 오류를 해결했다.
